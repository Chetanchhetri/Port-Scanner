<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetScan Pro - Secure Your Perimeter</title>
    <!-- Load Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons (CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // --- LIGHT THEME COLORS ---
                        'bg-light': '#FFFFFF',       // Main Page Background (White)
                        'card-light': '#F4F6F9',     // Card/Section Background (Light Gray)
                        'text-dark': '#1F2937',      // Primary Text Color (Dark Gray/Black)
                        'highlight-main': '#007BFF', // Deep Blue (Primary Accent)
                        'primary-btn': '#007BFF',    // Deep Blue
                        'secondary-btn': '#5B9DFE',  // Sky Blue
                        'danger-alert': '#DC3545',   // Standard Red for warnings
                        'border-light': '#D1D5DB',   // Light Border Color
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: theme('colors.bg-light');
            color: theme('colors.text-dark');
            line-height: 1.6;
        }

        /* Custom Button & Highlight Utilities */
        .btn-primary-custom {
            background-color: theme('colors.primary-btn');
            color: theme('colors.bg-light'); /* White text on button */
            transition: all 0.3s;
            border-width: 2px;
            border-color: theme('colors.primary-btn');
        }
        .btn-primary-custom:hover {
            background-color: transparent;
            color: theme('colors.primary-btn');
        }

        /* Hero Section Animation (Updated Gradient for Light Theme) */
        .hero-bg-gradient {
            background: radial-gradient(circle at center top, rgba(0, 123, 255, 0.05) 0%, rgba(255, 255, 255, 1) 40%);
        }

        /* Mock Result/Output Styling */
        .mock-result {
            transition: all 0.5s ease; 
        }

        /* Loading Bar Animation */
        .loading-fill {
            height: 100%;
            background-color: theme('colors.primary-btn');
            width: 0%;
            transition: width 2s ease-in-out;
        }

        .summary { 
            margin-top: 15px; 
            padding: 10px; 
            background-color: theme('colors.danger-alert'); /* Standard Red for high visibility */
            border-radius: 0.375rem; 
            color: theme('colors.bg-light'); /* White text on red background */
            font-weight: 600;
        }

        /* Custom Hover Effect for Steps/Cards (Updated Border) */
        .card-hover-effect:hover {
            transform: translateY(-5px);
            border-color: theme('colors.primary-btn');
        }

        /* AI Analysis Specific Styles */
        .ai-analysis-container {
            margin-top: 20px;
            padding: 20px;
            border: 2px solid theme('colors.primary-btn');
            border-radius: 8px;
            background-color: theme('colors.bg-light');
            text-align: left;
        }
        .ai-analysis-title {
            color: theme('colors.primary-btn');
            font-weight: bold;
            border-bottom: 1px solid theme('colors.border-light');
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        /* Style for the actual terminal output */
        #scanOutput pre {
            white-space: pre-wrap; 
            word-wrap: break-word;
            font-family: monospace;
            overflow-x: auto;
            color: #1F2937; /* Dark text for light theme terminal */
            background-color: #E5E7EB; /* Lighter gray background for terminal */
            padding: 1rem;
            border-radius: 0.375rem;
        }

        /* Tab Switcher Styles adaptation */
        .tab-option {
            flex: 1;
            text-align: center;
            padding: 0.6rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .tab-option.active {
            background: theme('colors.highlight-main');
            color: theme('colors.bg-light');
            border-radius: 6px;
        }
        .tab-option:not(.active) {
            color: theme('colors.text-dark');
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-card-light shadow-lg border-b-4 border-highlight-main sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center flex-wrap">
            <h1 class="text-2xl font-extrabold text-text-dark">NetScan<span class="text-highlight-main">Pro</span></h1>
            <nav class="flex items-center space-x-4 mt-3 sm:mt-0">
                <a href="#features" class="text-text-dark hover:text-highlight-main transition duration-300 hidden sm:inline">Features</a>
                <a href="#pricing" class="text-text-dark hover:text-highlight-main transition duration-300 hidden sm:inline">Pricing</a>
                <a href="javascript:void(0)" id="openLoginModalBtn" class="px-3 py-2 text-sm font-semibold rounded-md border-2 border-secondary-btn text-secondary-btn hover:bg-secondary-btn hover:text-bg-light transition duration-300">Login</a>
            </nav>
        </div>
    </header>

    <!-- 1. Hero Section -->
    <section id="hero" class="hero-bg-gradient text-center py-16 sm:py-24">
        <div class="max-w-4xl mx-auto px-4">
            <h2 class="text-5xl sm:text-6xl font-extrabold mb-4 leading-tight text-text-dark">
                Secure Your Perimeter. <br> Instant Port Scans with 
                <span class="text-highlight-main">Enterprise-Grade Accuracy</span>.
            </h2>
            <p class="text-xl text-gray-600 mb-8">
                Find open ports, map your attack surface, and uncover hidden network vulnerabilities in seconds.
            </p>

            <!-- Status Indicator -->
            <div id="status" class="text-center font-bold text-lg mb-4 text-gray-600">Idle</div>

            <!-- Scan Form and Inputs -->
            <div class="card bg-card-light p-6 rounded-xl shadow-2xl max-w-xl mx-auto border border-border-light">
                <form id="scanForm" class="text-left">
                    <label for="targetInput" class="block text-sm font-medium mb-2 text-gray-700">Target (domain or IP)</label>
                    <input name="target" id="targetInput" type="text" value="scanme.nmap.org" required
                           class="p-3 w-full border border-border-light bg-bg-light text-text-dark rounded-lg focus:outline-none focus:border-highlight-main mb-4" />

                    <!-- Toggle switcher -->
                    <div class="flex bg-card-light rounded-lg overflow-hidden border border-border-light mb-4 text-sm p-1">
                        <div id="tabDefault" class="tab-option active">Default scan (1–1024)</div>
                        <div id="tabCustom" class="tab-option">Custom port range</div>
                    </div>

                    <!-- Custom input fields -->
                    <div id="customInputs" class="space-y-4" style="display:none;">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="startPort" class="block text-sm font-medium mb-2 text-gray-700">Start port</label>
                                <input name="start" id="startPort" type="number" value="1" min="1" max="65535"
                                       class="p-3 w-full border border-border-light bg-bg-light text-text-dark rounded-lg focus:outline-none focus:border-highlight-main" />
                            </div>
                            <div>
                                <label for="endPort" class="block text-sm font-medium mb-2 text-gray-700">End port</label>
                                <input name="end" id="endPort" type="number" value="1024" min="1" max="65535"
                                       class="p-3 w-full border border-border-light bg-bg-light text-text-dark rounded-lg focus:outline-none focus:border-highlight-main" />
                            </div>
                        </div>
                    </div>

                    <label for="concurrency" class="block text-sm font-medium mb-2 text-gray-700 mt-4">Concurrency (Max 2000)</label>
                    <input name="concurrency" id="concurrency" type="number" value="500" min="1" max="2000"
                           class="p-3 w-full border border-border-light bg-bg-light text-text-dark rounded-lg focus:outline-none focus:border-highlight-main mb-4" />

                    <div class="flex items-center mb-6">
                        <input id="noBanner" name="no_banner" type="checkbox"
                               class="h-4 w-4 text-primary-btn border-border-light rounded focus:ring-primary-btn mr-2" />
                        <label for="noBanner" class="text-gray-700 font-medium m-0">Skip banner reads (Faster scan, less detail)</label>
                    </div>

                    <div class="flex items-center gap-4">
                        <button id="startBtn" type="submit" class="btn-primary-custom px-6 py-3 text-lg font-bold rounded-lg flex-1">
                            <i class="fas fa-rocket mr-2"></i> Start Scan
                        </button>
                    </div>
                    <div class="text-sm text-gray-500 mt-3">
                        Only scan systems you own or have permission to scan. Max port range 2000.
                    </div>
                </form>
            </div>

            <p class="text-sm text-gray-500 mt-3">Powered by the NetScan Engine | Trusted by 10,000+ SecOps Teams</p>

            <!-- Scan Result Container -->
            <div id="mockResult" class="mock-result mt-10 p-5 bg-card-light border border-border-light rounded-lg text-left shadow-lg max-w-4xl mx-auto" style="display: none;">
                <div id="scanOutput">
                    <!-- Scan output (plain text from Flask) will go here -->
                </div>
            </div>
        </div>
    </section>

    <!-- 2. How It Works -->
    <section id="how-it-works" class="py-20 bg-bg-light">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-4xl font-bold text-center mb-16 text-text-dark">How It Works: Security in 3 Simple Steps</h3>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="step p-6 bg-card-light rounded-xl border-t-4 border-border-light transition duration-300 card-hover-effect shadow">
                    <i class="fas fa-keyboard text-4xl text-highlight-main mb-4"></i>
                    <h4 class="text-xl font-semibold mb-2 text-text-dark">1. Define Target</h4>
                    <p class="text-gray-600">Enter the IP or Domain. Choose your scan type (Quick Top Ports, Full Range, or Stealth/SYN Scan).</p>
                </div>
                <div class="step p-6 bg-card-light rounded-xl border-t-4 border-border-light transition duration-300 card-hover-effect shadow">
                    <i class="fas fa-bolt text-4xl text-highlight-main mb-4"></i>
                    <h4 class="text-xl font-semibold mb-2 text-text-dark">2. Execute Scan</h4>
                    <p class="text-gray-600">Our cloud-hosted engine uses optimized techniques like SYN scans for lightning-fast and non-intrusive probing.</p>
                </div>
                <div class="step p-6 bg-card-light rounded-xl border-t-4 border-border-light transition duration-300 card-hover-effect shadow">
                    <i class="fas fa-file-invoice text-4xl text-highlight-main mb-4"></i>
                    <h4 class="text-xl font-semibold mb-2 text-text-dark">3. Get Actionable Results</h4>
                    <p class="text-gray-600">Instantly receive a clear, classified report showing port status, service versions, and security recommendations.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 3. Key Features & Benefits -->
    <section id="features" class="py-20 bg-card-light border-y border-border-light">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-4xl font-bold text-center mb-16 text-text-dark">Why Choose NetScan Pro?</h3>
            <div class="grid lg:grid-cols-4 md:grid-cols-2 gap-10">
                <div class="feature-card text-center p-4">
                    <i class="fas fa-tachometer-alt text-3xl text-secondary-btn mb-3"></i>
                    <h4 class="text-xl font-semibold mb-2 text-text-dark">Speed & Efficiency</h4>
                    <p class="text-gray-600">Quick top-port scans for immediate reconnaissance and scalable scanning for entire IP ranges.</p>
                </div>
                <div class="feature-card text-center p-4">
                    <i class="fas fa-shield-alt text-3xl text-secondary-btn mb-3"></i>
                    <h4 class="text-xl font-semibold mb-2 text-text-dark">Accuracy & Depth</h4>
                    <p class="text-gray-600">Industry-standard scanning techniques and detailed service version detection on open ports.</p>
                </div>
                <div class="feature-card text-center p-4">
                    <i class="fas fa-cogs text-3xl text-secondary-btn mb-3"></i>
                    <h4 class="text-xl font-semibold mb-2 text-text-dark">Reporting & Workflow</h4>
                    <p class="text-gray-600">Actionable reports with clear status (Open, Closed, Filtered) and easy export options (CSV/PDF).</p>
                </div>
                <div class="feature-card text-center p-4">
                    <i class="fas fa-user-secret text-3xl text-secondary-btn mb-3"></i>
                    <h4 class="text-xl font-semibold mb-2 text-text-dark">Stealth Scanning</h4>
                    <p class="text-gray-600">Utilize half-open SYN scans for authorized testing that minimizes logging and detection.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. Advanced/Premium Features Section (Monetization Hook) -->
    <section id="pricing" class="py-20 text-center bg-bg-light">
        <div class="max-w-3xl mx-auto px-4">
            <h3 class="text-4xl font-extrabold mb-4 text-primary-btn">Unlock Continuous Security Monitoring</h3>
            <p class="text-xl text-gray-600 mb-8">Go Pro for advanced features like **API integration**, scheduled scans, and full **65k port scans** required for comprehensive audits.</p>
            <div class="premium-features flex justify-center gap-6 sm:gap-10 flex-wrap mb-10 text-lg font-semibold text-text-dark">
                <span class="flex items-center"><i class="fas fa-check-circle text-primary-btn mr-2"></i> 24/7 Scheduled Monitoring</span>
                <span class="flex items-center"><i class="fas fa-check-circle text-primary-btn mr-2"></i> Full API Access</span>
                <span class="flex items-center"><i class="fas fa-check-circle text-primary-btn mr-2"></i> Full 65k Port Scans</span>
            </div>
            <a href="#" class="btn-primary-custom px-8 py-4 text-xl font-bold rounded-lg">View Premium Pricing</a>
        </div>
    </section>

    <!-- 5. Testimonials -->
    <section id="testimonials" class="py-20 bg-card-light border-y border-border-light">
        <div class="max-w-4xl mx-auto px-4">
            <h3 class="text-4xl font-bold text-center mb-12 text-text-dark">Trusted by Professionals</h3>
            <div class="p-8 sm:p-12 bg-bg-light border border-primary-btn rounded-xl text-center shadow-2xl">
                <p class="italic text-xl mb-4 text-gray-700">"Switched from CLI Nmap to this tool. The speed and the clear, actionable reports have saved my team hours every week. Essential for modern SecOps."</p>
                <p class="font-semibold text-lg text-secondary-btn">- **Mark H.** | Senior Network Engineer at TechCorp</p>
            </div>
        </div>
    </section>

    <!-- 6. Final Call-to-Action -->
    <section id="final-cta" class="py-24 text-center bg-bg-light">
        <div class="max-w-4xl mx-auto px-4">
            <h2 class="text-4xl sm:text-5xl font-extrabold mb-8 text-text-dark">Ready to See What Your Network is Hiding?</h2>
            <a href="#" class="btn-primary-custom px-10 py-5 text-2xl font-bold rounded-lg">Start Your Free Scan Now</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-card-light py-6 text-center border-t border-border-light">
        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm text-gray-500">
                &copy; 2025 NetScanPro. All rights reserved. | 
                <a href="#" class="hover:text-text-dark transition duration-300">Privacy Policy</a> | 
                <a href="#" class="hover:text-text-dark transition duration-300">Terms of Service</a>
            </p>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-text-dark bg-opacity-70 z-50 flex justify-center items-center hidden">
        <div class="bg-bg-light p-8 w-11/12 max-w-md rounded-xl shadow-2xl border border-border-light relative">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-500 hover:text-text-dark transition duration-300">
                <i class="fas fa-times text-2xl"></i>
            </button>
            <h3 class="text-3xl font-extrabold text-center mb-6 text-text-dark">Welcome Back</h3>
            <p class="text-center text-gray-600 mb-8">Access your continuous monitoring dashboards and full scan reports.</p>
            
            <form onsubmit="event.preventDefault(); handleLogin();">
                <div class="mb-5">
                    <label for="email" class="block text-sm font-medium mb-2 text-gray-700">Email Address</label>
                    <input type="email" id="email" required 
                           class="w-full p-3 bg-card-light border border-border-light rounded-lg text-text-dark focus:ring-primary-btn focus:border-primary-btn outline-none transition">
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium mb-2 text-gray-700">Password</label>
                    <input type="password" id="password" required 
                           class="w-full p-3 bg-card-light border border-border-light rounded-lg text-text-dark focus:ring-primary-btn focus:border-primary-btn outline-none transition">
                </div>
                <button type="submit" class="w-full btn-primary-custom px-4 py-3 text-lg font-bold rounded-lg">
                    Login Securely
                </button>
            </form>
            
            <div id="loginMessage" class="mt-4 text-center text-sm font-semibold text-danger-alert" style="display: none;"></div>
            
            <p class="mt-6 text-center text-sm text-gray-500">
                Don't have an account? <a href="#" class="text-secondary-btn hover:text-primary-btn">Sign Up</a>
            </p>
        </div>
    </div>

    <!-- JavaScript for interactivity and Gemini API -->
    <script>
        // Global state for API interaction
        let currentMockScanData = '';
        const API_BASE_URL = "/"; // Use relative path for Flask endpoints
        
        // DOM refs
        const form = document.getElementById('scanForm');
        const statusEl = document.getElementById('status');
        const targetInput = document.getElementById('targetInput');
        const mockResult = document.getElementById('mockResult');
        
        const tabDefault = document.getElementById('tabDefault');
        const tabCustom = document.getElementById('tabCustom');
        const customInputs = document.getElementById('customInputs');
        const startPortEl = document.getElementById('startPort');
        const endPortEl = document.getElementById('endPort');
        const noBannerEl = document.getElementById('noBanner');

        const DEFAULT_START = 1;
        const DEFAULT_END = 1024;
        let scanMode = "default";

        // Login Modal Elements
        const loginModal = document.getElementById('loginModal');
        const openLoginModalBtn = document.getElementById('openLoginModalBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const loginMessage = document.getElementById('loginMessage');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');

        // --- Modal Open/Close Logic ---
        openLoginModalBtn.addEventListener('click', () => {
            loginModal.classList.remove('hidden');
            loginMessage.style.display = 'none';
            loginMessage.classList.remove('text-primary-btn');
            loginMessage.classList.add('text-danger-alert');
        });

        closeModalBtn.addEventListener('click', () => {
            loginModal.classList.add('hidden');
        });
        
        loginModal.addEventListener('click', (e) => {
            if (e.target === loginModal) {
                loginModal.classList.add('hidden');
            }
        });
        
        // --- Mock Login Handler ---
        window.handleLogin = function() {
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            
            loginMessage.style.display = 'block';

            if (email === "test@pro.com" && password === "password") {
                loginMessage.textContent = "Login Successful! Redirecting to Dashboard...";
                loginMessage.classList.remove('text-danger-alert');
                loginMessage.classList.add('text-primary-btn');
                
                setTimeout(() => {
                    loginModal.classList.add('hidden');
                    emailInput.value = '';
                    passwordInput.value = '';
                }, 1500);
            } else {
                loginMessage.textContent = "Invalid credentials. Try test@pro.com / password";
                loginMessage.classList.remove('text-primary-btn');
                loginMessage.classList.add('text-danger-alert');
            }
        }


        // --- UI Helper Functions ---

        function showLoading(targetValue) {
            mockResult.innerHTML = `
                <p class="text-primary-btn font-mono">Scanning <span id="mockTarget">${targetValue}</span>...</p>
                <div class="loading-bar h-2 bg-border-light rounded-full mt-2 mb-4 overflow-hidden">
                    <div class="loading-fill" id="loadingFill" style="width: 0%;"></div>
                </div>
            `;
            mockResult.style.display = 'block';

            const loadingFill = document.getElementById('loadingFill');
            requestAnimationFrame(() => {
                loadingFill.style.width = '100%';
            });
        }

        function showResultsUI(targetValue, rawOutput) {
            const hasOpenPorts = rawOutput.includes("OPEN:"); 
            
            let summaryMessage = "Scan Complete: Review the detailed output below.";
            let summaryClass = "bg-primary-btn text-bg-light";
            
            if (hasOpenPorts) {
                summaryMessage = "High Risk: Open ports detected. Review report and analyze!";
                summaryClass = "bg-danger-alert text-bg-light";
            }

            // Clean up old analysis if it exists
            const oldAnalysis = document.getElementById('aiAnalysisReportWrapper');
            if (oldAnalysis) oldAnalysis.remove();

            mockResult.innerHTML = `
                <p class="summary ${summaryClass} mb-4">${summaryMessage}</p>
                <div id="scanOutput" class="text-sm border border-border-light rounded-lg overflow-x-auto p-4 bg-gray-50">
                    <pre class="font-mono whitespace-pre-wrap">${rawOutput}</pre>
                </div>
                
                <div class="mt-5 flex flex-col sm:flex-row gap-4">
                    <button class="btn-primary-custom px-4 py-3 text-base font-bold rounded-lg flex-1" 
                            onclick="window.analyzeSecurityRisk(currentMockScanData)">
                        <i class="fas fa-brain mr-2"></i>✨ Analyze Risk & Mitigation (Mock AI)
                    </button>
                    <button class="px-4 py-3 text-base font-bold rounded-lg border-2 border-border-light text-text-dark hover:border-primary-btn transition flex-1" 
                            onclick="window.location.reload()">
                        Start New Scan
                    </button>
                </div>

                <div id="aiAnalysisReport" class="ai-analysis-container mt-6">
                    <p class="text-gray-500">Click "Analyze Risk & Mitigation (Mock AI)" to generate a custom security report.</p>
                </div>
            `;
        }

        function showErrorUI(targetValue, errorMessage) {
            mockResult.innerHTML = `
                <p class="summary bg-danger-alert text-bg-light mb-4">Scan failed for ${targetValue}!</p>
                <div class="text-sm border border-danger-alert rounded-lg overflow-x-auto p-4 bg-gray-50">
                    <pre class="font-mono whitespace-pre-wrap">ERROR: ${errorMessage}</pre>
                </div>
                <button class="btn-primary-custom px-4 py-3 text-base font-bold rounded-lg mt-5" 
                        onclick="window.location.reload()">
                    Try New Scan
                </button>
            `;
            mockResult.style.display = 'block';
        }
        
        // --- Gemini API Call Logic (REPLACED WITH MOCK) ---
        const analyzeSecurityRisk = async (scanData) => {
            const analysisContainer = document.getElementById('aiAnalysisReport');
            
            // Show loading spinner
            analysisContainer.innerHTML = `
                <div class="flex items-center justify-center space-x-2 text-primary-btn">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Analyzing risks (Mock AI)...</span>
                </div>
            `;
            
            // HARDCODED MOCK ANALYSIS
            const mockAnalysisMarkdown = `
## AI Risk Analysis & Mitigation Plan

### Risk Assessment

* **Risk Level: MODERATE to HIGH** - The final determination depends on the specific services running on the detected open ports (e.g., 22, 80, 443). Open ports represent the primary attack surface.
* **Vulnerability Focus:** The risk is concentrated in the versions of the application software hosting these services. An unpatched web server or SSH daemon is a direct exploitation vector.
* **Data Exposure:** Services handling data (like web servers) require strict security headers and access controls to prevent data leakage and enumeration attacks.

### Mitigation Plan

* **1. Immediate Service Verification:** Check the specific service version and vendor for every open port identified in the scan report. Cross-reference these versions against public vulnerability databases (e.g., CVE).
* **2. Harden Access Control:** For administrative ports like SSH (22), disable password login and enforce key-based authentication. For web ports (80/443), ensure strong WAF/DDoS protection is in place.
* **3. Disable Unnecessary Ports:** Any port found open that does not explicitly serve a business function must be immediately firewalled or disabled within the application. Adopt a "deny-by-default" security posture.
`;
            
            // Simulate network delay for a better UX (2 seconds)
            await new Promise(r => setTimeout(r, 2000));
            
            let resultText = mockAnalysisMarkdown;

            // Convert Mock Markdown to HTML for display
            let htmlContent = resultText
                .replace(/^## (.*$)/gim, '<h3 class="ai-analysis-title text-2xl font-bold">$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n\*/g, '<p class="pl-4"><i class="fas fa-arrow-right text-secondary-btn mr-2"></i>')
                .replace(/([^*]+$)/gm, '$1</p>');
            
            htmlContent = htmlContent.replace(/\*/g, '').replace(/(\/p>)\s*(\/p>)/g, '$1');

            analysisContainer.innerHTML = htmlContent;
        };
        window.analyzeSecurityRisk = analyzeSecurityRisk;


        // --- Tab Switching Logic ---
        function activateTab(mode) {
            scanMode = mode;
            tabDefault.classList.remove('active', 'text-gray-600', 'hover:bg-bg-light');
            tabCustom.classList.remove('active', 'text-gray-600', 'hover:bg-bg-light');
            
            if (mode === "default") {
                tabDefault.classList.add("active");
                tabCustom.classList.add("text-gray-600", "hover:bg-bg-light");
                customInputs.style.display = "none";
                startPortEl.value = DEFAULT_START;
                endPortEl.value = DEFAULT_END;
            } else {
                tabCustom.classList.add("active");
                tabDefault.classList.add("text-gray-600", "hover:bg-bg-light");
                customInputs.style.display = "block";
            }
        }
        tabDefault.addEventListener("click", () => activateTab("default"));
        tabCustom.addEventListener("click", () => activateTab("custom"));
        activateTab('default'); // Initialize tab state


        // --- Main Scan Submission ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const targetValue = (targetInput.value || "").trim();
            showLoading(targetValue);
            statusEl.textContent = "Submitting job...";
            
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;
            startBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            
            const data = new FormData(form);
            const payload = {};
            payload.target = targetValue;
            payload.concurrency = parseInt(data.get('concurrency') || "500", 10);

            if (scanMode === "custom") {
                payload.start = parseInt(startPortEl.value || DEFAULT_START, 10);
                payload.end = parseInt(endPortEl.value || DEFAULT_END, 10);
            } else {
                payload.start = DEFAULT_START;
                payload.end = DEFAULT_END;
            }
            payload.no_banner = noBannerEl.checked;

            // Simple client-side validation based on Flask's limits
            if (!payload.target || (payload.end - payload.start + 1) > 2000) {
                showErrorUI(targetValue, !payload.target ? "Target is required." : "Port range too large (max 2000).");
                statusEl.textContent = "Error";
                startBtn.disabled = false;
                startBtn.innerHTML = '<i class="fas fa-rocket mr-2"></i> Start Scan';
                return;
            }

            try {
                const res = await fetch(`${API_BASE_URL}scan`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const json = await res.json();
                
                if (json.job_id) {
                    statusEl.textContent = "Job submitted: " + json.job_id;
                    poll(json.job_id, targetValue);
                } else {
                    showErrorUI(targetValue, json.error || JSON.stringify(json));
                    statusEl.textContent = "Error";
                }
            } catch (err) {
                showErrorUI(targetValue, "Error submitting job: " + err);
                statusEl.textContent = "Error";
            } finally {
                startBtn.disabled = false;
                startBtn.innerHTML = '<i class="fas fa-rocket mr-2"></i> Start Scan';
            }
        });

        // --- Polling results ---
        async function poll(job_id, targetValue) {
            statusEl.textContent = "Polling job " + job_id + "...";
            const startTs = Date.now();
            const interval = 2000;
            const maxTime = 15 * 60 * 1000; // 15 minutes max poll time

            while (Date.now() - startTs < maxTime) {
                try {
                    const r = await fetch(`${API_BASE_URL}scan-status/${job_id}?format=txt`);
                    const ct = r.headers.get("content-type") || "";
                    
                    if (ct.includes("text/plain")) {
                        const txt = await r.text();
                        
                        // Success path
                        currentMockScanData = txt;
                        showResultsUI(targetValue, txt);
                        statusEl.textContent = "✅ Scan Complete";
                        return;
                    }

                    const j = await r.json();
                    if (j.status === 'running') {
                        // Display status update without wiping the loading animation
                        statusEl.textContent = `Running... (submitted at ${new Date(j.created*1000).toLocaleTimeString()})`;
                    } else if (j.status === 'error') {
                        showErrorUI(targetValue, j.error || "Unknown Error");
                        statusEl.textContent = "Error";
                        return;
                    }
                } catch (err) {
                    showErrorUI(targetValue, "Poll error: " + err);
                    statusEl.textContent = "Poll error"; return;
                }
                
                // Wait for the next poll interval
                await new Promise(r => setTimeout(r, interval));
            }

            showErrorUI(targetValue, "Polling timed out after 15 minutes.");
            statusEl.textContent = "Timed out";
        }
    </script>
</body>
</html>
